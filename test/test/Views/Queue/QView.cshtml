@model test.Database.QueueDbModel
@{
    ViewData["Title"] = "QView";
}

    <p>Queue - @Model.Name</p>
    <p>Short discription : @Model.About</p>
    <p>Model - @Model.Priority</p>

    <table id="Queue"></table>

    @if (User.Identity.IsAuthenticated)
    {
        <input type="number" id="inputPriority" />
        <button onclick="AddToQ()"> Join Queue</button>
        <button onclick="DeleteFromQueue('@User.Identity.Name')"> Leave Queue</button>
    }
@{ 

}

<script src="~/lib/signalr/dist/browser/signalr.min.js"></script>
<script>
    "use strict";

    const connection = new signalR.HubConnectionBuilder().withUrl("/QueueTest").build();

    connection.on("GetNotify", function () {
        ViewQueue();
    });

    connection.start().then(function () {
        connection.invoke("AddToGroup", "@Model.Id");
        ViewQueue();
    })


    function ViewQueue() {
        $.ajax({
            url: '/Queue/AjaxShowQueueInfo?Id=@Model.Id',
            success: function (data) {
                    document.getElementById("Queue").innerHTML = data;
                }
        });
    }

    function AddToQ() {
        $.ajax({
            url: '/Queue/AjaxAddToQueue?Id=@Model.Id&Priority=' + document.getElementById("inputPriority").value,
            success: function (returnData) {
                if (returnData) { connection.invoke("SendGroupNotify", "@Model.Id") } ;
            }
        });
    }

    function DeleteFromQueue(Name) {
        $.ajax({
            url: '/Queue/AjaxDeleteFromQueue?Id=@Model.Id&Name=' + Name,
            success: function (returnData) {
                if (returnData) { connection.invoke("SendGroupNotify", "@Model.Id") } ;
            }
        });
    }

    function ChangePriority(Name) {
        $.ajax({
            url: '/Queue/AjaxChangePriority?Id=@Model.Id&Name=' + Name + '&Priority=' + prompt ("inter priority", 0),
            success: function (returnData) {
                if (returnData) { connection.invoke("SendGroupNotify", "@Model.Id") } ;
            }
        });
    }
</script>





